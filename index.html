<!doctype html>
<html lang="nl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Mijn Theekunde</title>
  <link rel="stylesheet" href="styles.css" />
</head>

<body class="home">
  <header class="header">
    <div class="container">
      <h1>Mijn Theekunde</h1>
      <p class="muted">Soorten thee & kruiden — en waarvoor ze vaak gebruikt worden.</p>
    </div>
  </header>

  <main class="container">

    <!-- ✅ ENIGE zoekblok (dus geen dubbele) -->
    <section class="search-panel" aria-label="Zoeken en filters">

      <div class="search-row">
        <input
          id="search"
          class="search-input"
          type="search"
          placeholder="Zoek op naam of eigenschap... (bv. kamille, slaap, maag, cafeïnevrij)"
          autocomplete="off"
        />
        <button id="clearSearch" class="search-btn" type="button">Wis</button>
      </div>

      <!-- chips met actieve filters (wordt gevuld door JS) -->
      <div id="chipRow" class="chip-row" role="list" aria-label="Filters"></div>

      <!-- alfabet (A–Z) -->
      <div id="alphabet" class="alphabet" aria-label="Alfabet"></div>

      <!-- termen per letter (wordt gevuld door JS) -->
      <div id="termRow" class="term-row" aria-label="Termen per letter"></div>

      <p id="resultCount" class="muted search-count"></p>
    </section>

    <!-- =========================
         JOUW OVERZICHT (items)
         ========================= -->

    <section>
      <h2>Thee</h2>

      <h3 class="item" data-tags="ochtend middag focus energie">
        <a href="thee/groene-thee.html">Groene thee</a>
      </h3>

      <h3 class="item" data-tags="middag bewust focus">
        <a href="thee/oolong-thee.html">Oolong</a>
      </h3>

      <h3 class="item" data-tags="ochtend energie focus cafeïne">
        <a href="thee/zwarte-thee.html">Zwarte thee</a>
      </h3>
    </section>

    <section>
      <h2>Kruiden</h2>

      <h3 class="item" data-tags="medicinaal lever spijsvertering opwekkend">
        <a href="thee/agrimonie.html">Agrimonie</a>
      </h3>

      <h3 class="item" data-tags="avond rust slaap ontspanning stress">
        <a href="thee/ashwagandha.html">Ashwagandha</a>
      </h3>

      <h3 class="item" data-tags="avond ontspanning rust slaap cafeïnevrij">
        <a href="thee/kamille.html">Kamille</a>
      </h3>

      <h3 class="item" data-tags="spijsvertering maag fris cafeïnevrij">
        <a href="thee/pepermunt.html">Pepermunt</a>
      </h3>
    </section>

    <section>
      <h2>Specerijen</h2>

      <h3 class="item" data-tags="specerij kaneel spijsvertering verwarmend bloedcirculatie cafeïnevrij">
        <a href="thee/kaneel.html">Kaneel</a>
      </h3>
    </section>

    <section>
      <h2>Bloemen &amp; bloesems</h2>

      <h3 class="item" data-tags="bloem ontspanning kalmerend geurend cafeïnevrij roos rozenblaadjes">
        <a href="thee/rozenblaadjes.html">Rozenblaadjes</a>
      </h3>
    </section>

    <section>
      <h2>Wortel</h2>

      <h3 class="item" data-tags="wortel ochtend middag spijsvertering verwarmend misselijkheid cafeïnevrij">
        <a href="thee/gember.html">Gember</a>
      </h3>

      <h3 class="item" data-tags="wortel reinigend spijsvertering lever gal cafeïnevrij paardenbloem">
        <a href="thee/paardenbloem.html">Paardenbloem (wortel)</a>
      </h3>

      <h3 class="item" data-tags="wortel ochtend middag avond keelpijn prikkelhoest maag darm ontstekingswerend cafeïnevrij">
        <a href="thee/zoethout.html">Zoethout</a>
      </h3>
    </section>

    <section>
      <h2>Vrucht</h2>
      <p class="muted">Binnenkort toegevoegd</p>
    </section>

  </main>

  <!-- ✅ ENIGE scriptblok -->
  <script>
    // -------- helpers --------
    function normalizeText(str) {
      return (str || "")
        .toLowerCase()
        .normalize("NFD")
        .replace(/[\u0300-\u036f]/g, "")       // accenten weg
        .replace(/[^a-z0-9\s-]/g, " ")        // rare tekens weg
        .replace(/\s+/g, " ")
        .trim();
    }

    function unique(arr) {
      return Array.from(new Set(arr));
    }

    // -------- elements --------
    const searchInput  = document.getElementById("search");
    const clearBtn     = document.getElementById("clearSearch");
    const resultCount  = document.getElementById("resultCount");
    const chipRow      = document.getElementById("chipRow");
    const alphabetEl   = document.getElementById("alphabet");
    const termRow      = document.getElementById("termRow");

    const items = Array.from(document.querySelectorAll(".item"));

    // Index: titel + tags
    const itemIndex = items.map(el => {
      const title = el.textContent || "";
      const tags  = el.getAttribute("data-tags") || "";
      return {
        el,
        haystack: normalizeText(title + " " + tags),
        title: normalizeText(title),
        tags: normalizeText(tags),
      };
    });

    // Verzamel ALLE termen uit data-tags + titles (woorden)
    const allTerms = unique(
      itemIndex.flatMap(x => {
        const words = (x.title + " " + x.tags).split(" ");
        return words.map(w => normalizeText(w)).filter(Boolean);
      })
    ).filter(t => t.length >= 2); // filter super-korte rommel (zoals "en", "of")

    // Maak alfabet A–Z
    const letters = "ABCDEFGHIJKLMNOPQRSTUVWXYZ".split("");
    let activeLetter = null;

    function renderAlphabet() {
      alphabetEl.innerHTML = "";
      letters.forEach(letter => {
        const btn = document.createElement("button");
        btn.type = "button";
        btn.className = "az-btn";
        btn.textContent = letter;

        btn.addEventListener("click", () => {
          activeLetter = (activeLetter === letter) ? null : letter;
          renderAlphabet();    // opnieuw tekenen voor active state
          renderTermsForLetter(activeLetter);
        });

        if (activeLetter === letter) btn.classList.add("is-active");
        alphabetEl.appendChild(btn);
      });
    }

    // Termen tonen voor gekozen letter
    function renderTermsForLetter(letter) {
      termRow.innerHTML = "";
      if (!letter) return;

      const starts = allTerms
        .filter(t => t[0] && t[0].toUpperCase() === letter)
        .sort((a,b) => a.localeCompare(b, "nl"));

      if (starts.length === 0) {
        const p = document.createElement("p");
        p.className = "muted";
        p.textContent = "Geen termen onder deze letter.";
        termRow.appendChild(p);
        return;
      }

      starts.forEach(term => {
        const btn = document.createElement("button");
        btn.type = "button";
        btn.className = "chip";
        btn.textContent = term;

        btn.addEventListener("click", () => {
          toggleFilter(term);
        });

        termRow.appendChild(btn);
      });
    }

    // Filters (chips)
    const activeFilters = new Set();

    function toggleFilter(term) {
      if (activeFilters.has(term)) activeFilters.delete(term);
      else activeFilters.add(term);

      renderActiveChips();
      applyFilters();
    }

    function renderActiveChips() {
      chipRow.innerHTML = "";

      if (activeFilters.size === 0) return;

      Array.from(activeFilters)
        .sort((a,b) => a.localeCompare(b, "nl"))
        .forEach(term => {
          const btn = document.createElement("button");
          btn.type = "button";
          btn.className = "chip is-active";
          btn.textContent = term;

          btn.addEventListener("click", () => {
            toggleFilter(term);
          });

          chipRow.appendChild(btn);
        });
    }

    // Filter logic: zoektekst (woorden) + actieve filters
    function applyFilters() {
      const q = normalizeText(searchInput.value);
      const words = q ? q.split(" ") : [];

      const filters = Array.from(activeFilters);

      let visible = 0;

      itemIndex.forEach(({ el, haystack }) => {
        const matchText =
          words.length === 0 || words.every(w => haystack.includes(w));

        const matchFilters =
          filters.length === 0 || filters.every(f => haystack.includes(f));

        const show = matchText && matchFilters;
        el.style.display = show ? "" : "none";
        if (show) visible++;
      });

      if (!q && filters.length === 0) {
        resultCount.textContent = "";
      } else {
        resultCount.textContent =
          visible === 0
            ? "Geen resultaten gevonden."
            : `${visible} resultaat${visible === 1 ? "" : "en"} zichtbaar.`;
      }
    }

    // Events
    searchInput.addEventListener("input", applyFilters);

    clearBtn.addEventListener("click", () => {
      searchInput.value = "";
      activeFilters.clear();
      activeLetter = null;
      renderAlphabet();
      termRow.innerHTML = "";
      chipRow.innerHTML = "";
      applyFilters();
      searchInput.focus();
    });

    // Init
    renderAlphabet();
    applyFilters();
  </script>
</body>
</html>
